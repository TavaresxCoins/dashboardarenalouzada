<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aulas do Dia - Arena Louzada</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root{--primary-color:#ffc400;--primary-hover-color:#e6b000;--dark-bg:#1a1a1a;--dark-card:#2c2c2c;--text-light:#f0f0f0;--text-muted:#a0a0a0;--border-color:#444;--success-color:#28a745;--danger-color:#e74c3c;}*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}body{display:flex;background-color:var(--dark-bg);color:var(--text-light);transition:opacity .4s ease-out}
        .app-layout{display:flex;width:100%;min-height:100vh}
        .sidebar{width:240px;background-color:var(--dark-card);padding:20px;display:flex;flex-direction:column;border-right:1px solid var(--border-color)}
        .sidebar-header{text-align:center;margin-bottom:40px}.sidebar-header img{width:80px;height:80px;border-radius:50%;object-fit:cover;border:2px solid var(--primary-color);margin-bottom:10px}
        .sidebar-header h2{font-size:1.2rem;color:var(--text-light)}
        .nav-menu{flex-grow:1}.nav-menu a{display:flex;align-items:center;padding:15px;margin-bottom:10px;border-radius:8px;text-decoration:none;color:var(--text-muted);font-weight:600;transition:background-color .3s,color .3s}.nav-menu a i{font-size:1.5rem;margin-right:15px}.nav-menu a.active,.nav-menu a:hover{background-color:var(--primary-color);color:#000}
        .main-content{flex-grow:1;padding:40px;overflow-y:auto;animation:slideUpFadeIn .6s ease-out forwards}@keyframes slideUpFadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}body.fade-out{opacity:0}
        
        .class-layout{display:grid;grid-template-columns:1fr 2fr;gap:30px}
        @media (max-width: 900px) { .class-layout { grid-template-columns: 1fr; } }
        .card{background-color:var(--dark-card);padding:25px;border-radius:10px}
        .card-header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border-color);padding-bottom:15px;margin-bottom:20px}
        .card h2{margin:0; padding:0; border:none;}
        .form-group{margin-bottom:15px}.form-group label{display:block;margin-bottom:8px;font-weight:600}
        .form-group input, .form-group select{width:100%;padding:12px;border-radius:8px;background-color:#3a3a3a;border:1px solid var(--border-color);color:var(--text-light);font-size:1rem}
        .submit-btn{width:100%;padding:15px;border:none;border-radius:8px;background-color:var(--primary-color);color:#000;font-size:1.1rem;font-weight:bold;cursor:pointer;transition:background-color .3s}.submit-btn:hover{background-color:var(--primary-hover-color)}
        
        .student-selection-list{background-color:#3a3a3a;border-radius:8px;padding:15px;max-height:250px;overflow-y:auto}
        .student-selection-list h4{margin-bottom:10px}
        .student-selection-list .student-item{display:flex;align-items:center;margin-bottom:10px;cursor:pointer}.student-selection-list .student-item input{margin-right:10px; width: 18px; height: 18px; accent-color: var(--primary-color);}
        .student-selection-list .student-item label { flex-grow: 1; cursor: pointer; }
        
        .class-day-group h3{color:var(--primary-color);margin-top:20px;margin-bottom:10px;padding-bottom:5px;border-bottom:1px solid var(--border-color)}
        .class-day-group:first-child h3 {margin-top:0;}
        .class-list-table{width:100%;border-collapse:collapse}.class-list-table th,.class-list-table td{padding:15px;border-bottom:1px solid var(--border-color);text-align:left}
        .class-list-table th{color:var(--text-muted);text-transform:uppercase;font-size:.9rem}
        .class-list-table .student-list-cell ul{padding-left:20px; margin: 0;}
        .class-list-table .student-list-cell li { margin-bottom: 5px; }
        .reset-btn{background-color:var(--danger-color);color:white;border:none;padding:8px 15px;border-radius:8px;font-weight:600;cursor:pointer;font-size:0.9rem;transition:background-color .3s}.reset-btn:hover{background-color:#c0392b}

    </style>
</head>
<body>
    <div class="app-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSNV8dxYF7dGp6TSUvr5KLLddCultBUPuo8XA&s" alt="Logo Arena Louzada">
                <h2>ARENA LOUZADA</h2>
            </div>
            <nav class="nav-menu">
                <a href="dashboard.html"><i class="ph-fill ph-house"></i> <span>Início</span></a>
                <a href="alunos.html"><i class="ph-fill ph-users"></i> <span>Alunos</span></a>
                <a href="presenca.html"><i class="ph-fill ph-check-square"></i> <span>Presença</span></a>
                <a href="aulas.html" class="active"><i class="ph-fill ph-chalkboard-teacher"></i> <span>Aulas do Dia</span></a>
                <a href="vendas.html"><i class="ph-fill ph-shopping-cart"></i> <span>Vendas</span></a>
                <a href="financas.html"><i class="ph-fill ph-currency-circle-dollar"></i> <span>Finanças</span></a>
            </nav>
        </aside>

        <main class="main-content">
            <h1>Aulas do Dia</h1>
            <p id="current-date" style="color: var(--text-muted); font-size: 1.2rem; margin-top:-5px; margin-bottom: 30px;"></p>

            <div class="class-layout">
                <div class="card">
                    <h2>Registrar Nova Aula</h2>
                    <form id="add-class-form">
                        <div class="form-group">
                            <label for="professor-name">Nome do Professor</label>
                            <input type="text" id="professor-name" required>
                        </div>
                        <div class="form-group">
                            <label for="class-day">Dia da Semana</label>
                            <select id="class-day" required>
                                <option value="" disabled selected>Selecione o dia</option>
                                <option value="Domingo">Domingo</option>
                                <option value="Segunda-feira">Segunda-feira</option>
                                <option value="Terça-feira">Terça-feira</option>
                                <option value="Quarta-feira">Quarta-feira</option>
                                <option value="Quinta-feira">Quinta-feira</option>
                                <option value="Sexta-feira">Sexta-feira</option>
                                <option value="Sábado">Sábado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="class-time">Horário da Aula</label>
                            <input type="time" id="class-time" required>
                        </div>
                        <div class="form-group">
                            <label for="class-duration">Duração (horas)</label>
                            <input type="number" id="class-duration" step="0.5" min="0.5" required>
                        </div>
                        <div class="student-selection-list">
                            <h4>Selecione os Alunos Presentes</h4>
                            <div id="student-selection-container">
                                <!-- Lista de alunos ativos para seleção -->
                            </div>
                        </div>
                        <button type="submit" class="submit-btn" style="margin-top: 15px;">Registrar Aula</button>
                    </form>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>Aulas Registradas Hoje</h2>
                        <button id="reset-classes-btn" class="reset-btn">Resetar Aulas do Dia</button>
                    </div>
                    <div id="registered-classes-container">
                        <!-- Conteúdo agrupado será gerado aqui -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dateEl = document.getElementById('current-date');
            const studentSelectionContainer = document.getElementById('student-selection-container');
            const registeredClassesContainer = document.getElementById('registered-classes-container');
            const addClassForm = document.getElementById('add-class-form');
            const resetBtn = document.getElementById('reset-classes-btn');

            function getTodayDateString() {
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            const today = getTodayDateString();
            dateEl.textContent = new Date(today + 'T12:00:00Z').toLocaleDateString('pt-BR', { dateStyle: 'full' });

            let allAlunos = JSON.parse(localStorage.getItem('alunos')) || [];
            
            function loadStudentSelection() {
                studentSelectionContainer.innerHTML = '';
                const alunosAtivos = allAlunos.filter(a => a.status === 'Ativo');

                if (alunosAtivos.length === 0) {
                    studentSelectionContainer.innerHTML = '<p style="color: var(--text-muted);">Nenhum aluno ativo encontrado.</p>';
                    return;
                }
                
                alunosAtivos.forEach(aluno => {
                    const item = document.createElement('div');
                    item.className = 'student-item';
                    item.innerHTML = `
                        <label>
                            <input type="checkbox" name="present-student" value="${aluno.matricula}">
                            ${aluno.nome}
                        </label>
                    `;
                    studentSelectionContainer.appendChild(item);
                });
            }
            
            function loadRegisteredClasses() {
                const aulas = JSON.parse(localStorage.getItem('aulas')) || {};
                const aulasHoje = aulas[today] || [];
                registeredClassesContainer.innerHTML = '';
                
                if (aulasHoje.length === 0) {
                    registeredClassesContainer.innerHTML = '<p style="text-align: center; color: var(--text-muted);">Nenhuma aula registrada hoje.</p>';
                    return;
                }

                const groupedByDay = aulasHoje.reduce((acc, aula) => {
                    const day = aula.dia || 'Sem Dia';
                    if (!acc[day]) acc[day] = [];
                    acc[day].push(aula);
                    return acc;
                }, {});

                const weekOrder = ["Domingo", "Segunda-feira", "Terça-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira", "Sábado"];

                weekOrder.forEach(day => {
                    if (groupedByDay[day]) {
                        const dayGroup = document.createElement('div');
                        dayGroup.className = 'class-day-group';
                        
                        const title = document.createElement('h3');
                        title.textContent = day;
                        dayGroup.appendChild(title);

                        const table = document.createElement('table');
                        table.className = 'class-list-table';
                        table.innerHTML = `<thead><tr><th>Professor</th><th>Horário</th><th>Duração</th><th>Alunos</th></tr></thead>`;
                        const tbody = document.createElement('tbody');

                        groupedByDay[day].forEach(aula => {
                            const row = document.createElement('tr');
                            const studentNames = aula.alunos.map(aluno => `<li>${aluno.nome}</li>`).join('');
                            row.innerHTML = `
                                <td>${aula.professor}</td>
                                <td>${aula.horarioInicio} - ${aula.horarioFim}</td>
                                <td>${aula.duracao}h</td>
                                <td class="student-list-cell"><ul>${studentNames || '<li>-</li>'}</ul></td>
                            `;
                            tbody.appendChild(row);
                        });

                        table.appendChild(tbody);
                        dayGroup.appendChild(table);
                        registeredClassesContainer.appendChild(dayGroup);
                    }
                });
            }

            addClassForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const professor = document.getElementById('professor-name').value;
                const dia = document.getElementById('class-day').value;
                const horario = document.getElementById('class-time').value;
                const duracao = parseFloat(document.getElementById('class-duration').value);

                const [startHour, startMinute] = horario.split(':').map(Number);
                const durationMinutes = duracao * 60;
                const endDate = new Date();
                endDate.setHours(startHour, startMinute + durationMinutes, 0, 0);
                const endHour = String(endDate.getHours()).padStart(2, '0');
                const endMinute = String(endDate.getMinutes()).padStart(2, '0');
                const horarioFim = `${endHour}:${endMinute}`;
                
                const selectedCheckboxes = studentSelectionContainer.querySelectorAll('input[type="checkbox"]:checked');
                const alunosPresentesNaAula = Array.from(selectedCheckboxes).map(checkbox => {
                    return allAlunos.find(a => a.matricula === checkbox.value);
                }).filter(Boolean);

                if (alunosPresentesNaAula.length === 0) {
                    alert('Por favor, selecione pelo menos um aluno para registrar a aula.');
                    return;
                }

                const newAula = {
                    id: Date.now(),
                    professor, dia, duracao,
                    horarioInicio: horario,
                    horarioFim: horarioFim,
                    alunos: alunosPresentesNaAula.map(a => ({ matricula: a.matricula, nome: a.nome }))
                };

                const aulas = JSON.parse(localStorage.getItem('aulas')) || {};
                if (!aulas[today]) {
                    aulas[today] = [];
                }
                aulas[today].push(newAula);
                localStorage.setItem('aulas', JSON.stringify(aulas));

                loadRegisteredClasses();
                addClassForm.reset();
                selectedCheckboxes.forEach(cb => cb.checked = false);
            });
            
            resetBtn.addEventListener('click', () => {
                if (confirm('Tem certeza que deseja apagar TODAS as aulas registradas hoje?')) {
                    const aulas = JSON.parse(localStorage.getItem('aulas')) || {};
                    delete aulas[today];
                    localStorage.setItem('aulas', JSON.stringify(aulas));
                    loadRegisteredClasses();
                }
            });

            // Initial Load
            loadStudentSelection();
            loadRegisteredClasses();
        });
    </script>
</body>
</html>

